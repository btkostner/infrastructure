apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
metadata:
  name: vpn-gateway

helmCharts:
  - name: pod-gateway
    repo: https://angelnu.github.io/helm-charts
    releaseName: pod-gateway
    namespace: vpn
    version: 6.5.1
    valuesFile: values.yaml

resources:
  - ./resources/namespace.yaml
  - ./resources/secret.yaml

transformers:
  - |-
    apiVersion: builtin
    kind: NamespaceTransformer
    metadata:
      name: notImportantHere
      namespace: vpn
    unsetOnly: true

patches:
  - target:
      kind: Certificate
      name: pod-gateway-webhook-tls
    patch: |-
      - op: replace
        path: "/spec/duration"
        value: "8760h0m0s"
  - target:
      kind: Certificate
      name: pod-gateway-webhook-ca
    patch: |-
      - op: replace
        path: "/spec/duration"
        value: "43800h0m0s"
