apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
metadata:
  name: argo-cd

namespace: argocd

resources:
  - https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/ha/install.yaml
  - ./resources/secret-repository.yaml
  - ./resources/secret-repo-creds.yaml

configMapGenerator:
  - name: argocd-cm
    behavior: merge
    literals:
      - "kustomize.buildOptions=--enable-helm"
      - "timeout.reconciliation=15s"
      # - "admin.enabled=false"
      - "accounts.btkostner=apiKey, login"
      - |
        resource.exclusions=
          - apiGroups:
              - cilium.io
            kinds:
              - CiliumIdentity
            clusters:
              - "*"
          - apiGroups:
              - velero.io
            kinds:
              - PodVolumeBackup
              - Backup
            clusters:
              - "*"
