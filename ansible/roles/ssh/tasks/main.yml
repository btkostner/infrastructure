---

- name: Install "openssh-server" package
  ansible.builtin.apt:
    name: openssh-server
    state: latest
    update_cache: true
  become: true
  notify: Enable "openssh-server"
  tags:
    - packages
    - security
    - ssh

- name: Remove "ServerKeyBits"
  ansible.builtin.lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#?ServerKeyBits"
    state: absent
  become: true
  notify: Reload "openssh-server"
  tags:
    - security
    - ssh

- name: Set "LoginGraceTime" to "60"
  ansible.builtin.lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#?LoginGraceTime"
    line: "LoginGraceTime 60"
  become: true
  notify: Reload "openssh-server"
  tags:
    - security
    - ssh

- name: Set "PermitRootLogin" to "no"
  ansible.builtin.lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#?PermitRootLogin"
    line: "PermitRootLogin no"
  become: true
  notify: Reload "openssh-server"
  tags:
    - security
    - ssh

- name: Set "PubkeyAuthentication" to "yes"
  ansible.builtin.lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#?PubkeyAuthentication"
    line: "PubkeyAuthentication yes"
  become: true
  notify: Reload "openssh-server"
  tags:
    - security
    - ssh

- name: Set "IgnoreUserKnownHosts" to "no"
  ansible.builtin.lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#?IgnoreUserKnownHosts"
    line: "IgnoreUserKnownHosts no"
  become: true
  notify: Reload "openssh-server"
  tags:
    - security
    - ssh

- name: Set "PermitEmptyPasswords" to "no"
  ansible.builtin.lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#?PermitEmptyPasswords"
    line: "PermitEmptyPasswords no"
  become: true
  notify: Reload "openssh-server"
  tags:
    - security
    - ssh

- name: Set "PasswordAuthentication" to "no"
  ansible.builtin.lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#?PasswordAuthentication"
    line: "PasswordAuthentication no"
  become: true
  notify: Reload "openssh-server"
  tags:
    - security
    - ssh

- name: Set "PrintMotd" to "yes"
  ansible.builtin.lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#?PrintMotd"
    line: "PrintMotd yes"
  become: true
  notify: Reload "openssh-server"
  tags:
    - security
    - ssh

- name: Set "Banner" to "/etc/issue.net"
  ansible.builtin.lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#?Banner"
    line: "Banner /etc/issue.net"
  become: true
  notify: Reload "openssh-server"
  tags:
    - ssh

- name: Template "/etc/issue.net"
  ansible.builtin.template:
    src: issue.net.j2
    dest: /etc/issue.net
    owner: root
    group: root
    mode: 0644
  become: true
  notify: Reload "openssh-server"
  tags:
    - ssh
