---

- name: Install "sudo" package
  ansible.builtin.apt:
    name: sudo
    state: "{{ users_package_state }}"
    update_cache: true
  become: true
  tags:
    - packages
    - users

- name: Configure "{{ users_sudo_group }}" group
  ansible.builtin.group:
    name: "{{ users_sudo_group }}"
    system: true
  become: true
  tags:
    - users

- name: Enable "{{ users_sudo_group }}" group
  ansible.builtin.lineinfile:
    dest: /etc/sudoers
    regexp: "^%{{ users_sudo_group }}"
    line: "%{{ users_sudo_group }}   ALL=(ALL:ALL) ALL"
  become: true
  tags:
    - security
    - users

- name: Setup users
  include_tasks: user.yml
  loop_control:
    label: "{{ user.username }}"
    loop_var: user
  loop: "{{ users }}"
  tags:
    - users
